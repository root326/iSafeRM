version: "3.8"
services:
  mysql:
    hostname: mysql
    deploy:
      restart_policy:
        condition: any
      replicas: {{ mysql_replicas|default(1) }}
      placement:
        constraints:
          - node.hostname == {{ deploy_host|default('wyl1') }}
      resources:
        limits:
          cpus: "{{ mysql_cpus|default(1) }}"
          memory: {{ mysql_memory|default(1) }}G
    ports:
      - target: {{ port|default('3306') }}
        published: {{ port|default('3306') }}
        protocol: tcp
        mode: host
    image: mysql:8.0.30
    environment:
      MYSQL_ROOT_PASSWORD: 123456
    volumes:
      - ~/tuning_microservice/.tmp/.mysql_tmp/templates/init.sql:/docker-entrypoint-initdb.d/init.sql
      - ~/tuning_microservice/.tmp/.mysql_tmp/my.cnf:/etc/mysql/conf.d/my.cnf
    command:
      --default-authentication-plugin=mysql_native_password
{#      - sql#}
{#      - CREATE TABLE usertable (YCSB_KEY VARCHAR(255) PRIMARY KEY,FIELD0 TEXT, FIELD1 TEXT,FIELD2 TEXT, FIELD3 TEXT,FIELD4 TEXT, FIELD5 TEXT,FIELD6 TEXT, FIELD7 TEXT,FIELD8 TEXT, FIELD9 TEXT);#}


